"use strict";function init_edd_repeater_colorpickers(e){var t=/value="(#(?:[0-9a-f]{3}){1,2})"/i;jQuery(e).find(".edd-color-picker").length>0&&jQuery(e).find(".edd-color-picker").each(function(e,a){var d=t.exec(jQuery(a)[0].outerHTML);d=null!==d?d[1]:jQuery(a).data("defaultColor"),jQuery(a).val(d).attr("value",d).wpColorPicker()})}function init_edd_repeater_chosen(e){jQuery(e).find("select.edd-slack-chosen").length&&jQuery(e).find(".edd-slack-chosen").chosen()}function initModals(){jQuery(".edd-rbm-repeater .edd-rbm-repeater-item").each(function(e,t){var a=jQuery(t).find(".edd-rbm-repeater-content.reveal");if(""!==a.attr("data-reveal"))return!0;var d=Math.round(Math.pow(36,7)-Math.random()*Math.pow(36,6)).toString(36).slice(1)+"-reveal";a.attr("data-reveal",d);jQuery(t).find("input[data-repeater-edit]").attr("data-open",d);a=new Foundation.Reveal(a)})}function openModal(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if("edd-rbm-repeater-add"==e.type){var a=jQuery(t);e=a.find("input[data-repeater-edit]").data("open")}var d=jQuery('[data-reveal="'+e+'"]');eddSlackSelectedDownloads=d.find(".edd-slack-download").val(),eddSlackSelectedDownloads=null===eddSlackSelectedDownloads?[]:eddSlackSelectedDownloads,d.foundation("open"),d.closest(".reveal-overlay").scrollTop(0)}function closeModal(e){var t=jQuery('[data-reveal="'+e+'"]');t.foundation("close")}!function(e){function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0===t&&(t=window.location.href),t=t.replace(/#.*$/,"");for(var a=t.split("&"),d=0;d<a.length;d++){var n=a[d].split("=");if(n[0]==e)return n[1]}return!1}var a=function(t,a){var d,n={};return n=function(t,a){var d={};return e.ajax({async:!1,type:"POST",url:location.origin+ajaxurl,data:{id:t,type:a,_ajax_nonce:e("#edd_slack_team_invite_nonce").val(),action:"edd_slack_app_team_invite"},success:function(e){var t="";if(e.ok===!1)switch(e.error){case"channel_not_found":t=eddSlack.i18n.slackInvite.channel_not_found;break;case"no_perms":t=eddSlack.i18n.slackInvite.no_perms;break;case"already_in_team":t=eddSlack.i18n.slackInvite.already_in_team;break;default:t=e.error}else t=eddSlack.i18n.slackInvite[a+"_invite_successful"];d={ok:e.ok,message:t}},error:function(e,t,a){console.error(e.responseText),console.error(a)}}),d}(t,a),d=n};e(document).ready(function(){e("#edd_slack_team_customer_invite_form, #edd_slack_team_vendor_invite_form").submit(function(d){d.preventDefault();var n=e(this),i=e(document.activeElement);i.attr("disabled",!0),n.find(".notice-wrap").remove(),n.append('<div class="notice-wrap"><span class="spinner is-active"></span></div>');var r=t("id"),o="customer";"edd_slack_team_vendor_invite_form"==d.currentTarget.id&&(o="vendor");var l=a(r,o);l.ok?n.find(".notice-wrap").append('<div class="updated"><p>'+l.message+"</p></div>"):(n.find(".notice-wrap").append('<div class="update error"><p>'+l.message+"</p></div>"),i.attr("disabled",!1)),n.find(".notice-wrap .spinner").remove()})})}(jQuery),HTMLFormElement.prototype.reportValidity||(HTMLFormElement.prototype.reportValidity=function(){var e=eddSlack.i18n.validationError,t=!0;return jQuery(this).find(".validation-error").remove(),jQuery(this).find(".required").each(function(a,d){d.setCustomValidity(""),jQuery(d).closest("td").hasClass("hidden")||null!==jQuery(d).val()&&""!=jQuery(d).val()||(d.setCustomValidity(e),jQuery(d).before('<span class="validation-error">'+e+"</span>"),t=!1)}),t?t:(jQuery(this).closest(".reveal-overlay").scrollTop(jQuery(this).find(".validation-error:first-of-type")),t)}),function(e){var t=e("[data-edd-rbm-repeater]");if(t.length){var a=function(){e(this).find(".repeater-header div.title").html(e(this).find(".repeater-header div.title").data("repeater-default-title")),e(this).stop().slideDown();var t=e(this).closest("[data-edd-rbm-repeater]");e(t).trigger("edd-rbm-repeater-add",[e(this)])},d=function(){var t=e(this).closest("[data-edd-rbm-repeater]"),a=confirm(eddSlack.i18n.confirmDeletion);if(a){var d=e(this),n=d.find("[data-repeater-edit]").data("open"),i=e('[data-reveal="'+n+'"]'),r=i.find(".edd-slack-post-id").val();e.ajax({type:"POST",url:eddSlack.ajax,data:{action:"delete_edd_rbm_slack_notification",post_id:r},success:function(a){i.parent().remove(),d.stop(),setTimeout(function(){d.effect("highlight",{color:"#FFBABA"},300).dequeue().slideUp(300,function(){d.remove()})}),e(t).trigger("edd-rbm-repeater-remove",[d])},error:function(e,t,a){}})}};t.each(function(){var t=e(this),n=t.find("[data-repeater-dummy]");t.repeater({repeaters:[{show:a,hide:d}],show:a,hide:d,ready:function(e){t.find("tbody").on("sortupdate",e)}}),n.length&&n.remove(),e(document).on("closed.zf.reveal",".edd-rbm-repeater-content.reveal",function(){var t=e(this).find('td:first-of-type input[type!="hidden"]'),a=e(this).closest(".edd-rbm-repeater-content.reveal").data("reveal"),d=e('[data-open="'+a+'"]');if(""!==e(t).val())d.closest(".edd-rbm-repeater-item").find(".repeater-header div.title").html(e(t).val());else{var n=d.closest(".edd-rbm-repeater-item").find(".repeater-header div.title").data("repeater-default-title");d.closest(".edd-rbm-repeater-item").find(".repeater-header div.title").html(n)}})})}}(jQuery),function(e){var t=function(t){var a=t.currentTarget,d=e(a).find("form");e(a).hasClass("has-form")||(d=e(a).find(".edd-rbm-repeater-form").wrap('<form method="POST" novalidate></form>').parent(),e(a).addClass("has-form"),d.submit(function(t){var n=e(document.activeElement),i=n.val();if(n.val(n.data("saving_text")).attr("disabled",!0),t.preventDefault(),d[0].reportValidity(),d[0].checkValidity()){var r=e(".edd-rbm-repeater-list").data("repeater-list"),o=new RegExp(r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"\\[\\d\\]\\[(.*)\\]","gi"),l={};e(this).find(".edd-slack-field:not( .chosen-container )").each(function(t,a){if(e(a).parent().hasClass("hidden"))return!0;var d=e(a).attr("name"),n=o.exec(d),i=e(a).val();e(a).is('input[type="checkbox"]')&&(i=e(a).prop("checked")?1:0),l[n[1].replace("][","")]=i,o.lastIndex=0}),l.action="insert_edd_rbm_slack_notification",e.ajax({type:"POST",url:eddSlack.ajax,data:l,success:function(t){var r=e(a).data("reveal"),o=e('[data-open="'+r+'"]').closest(".edd-rbm-repeater-item");d.find(".edd-slack-post-id").val(t.data.post_id),closeModal(r),n.val(i).attr("disabled",!1),o.effect("highlight",{color:"#DFF2BF"},1e3)},error:function(e,t,a){}})}else n.val(i).attr("disabled",!1)}))};e(document).ready(function(){e(document).on("open.zf.reveal",".edd-rbm-repeater-content.reveal",function(e){t(e)})})}(jQuery),function(e){e(document).ready(function(){initModals();var t=e("[data-edd-rbm-repeater]");t.length&&(t.on("edd-rbm-repeater-add",initModals),t.on("edd-rbm-repeater-add",openModal))}),e(document).on("click touched","[data-repeater-edit]",function(){openModal(e(this).data("open"))}),e(document).on("open.zf.reveal",".edd-rbm-repeater-content.reveal",function(){init_edd_repeater_colorpickers(this),init_edd_repeater_chosen(this)})}(jQuery);var eddSlackSelectedDownloads=[];!function(e){var t=function(t,a){if("edd-rbm-repeater-add"==t.type?(t=a,a=0):t=e(t).closest(".edd-rbm-repeater-content"),0==a)e(t).find("select").each(function(t,a){e(a).val(0),e(a).hasClass("edd-slack-chosen")&&e(a).trigger("chosen:updated")}),e(t).find(".edd-slack-conditional").closest("td").addClass("hidden"),e(t).find(".edd-slack-replacement-instruction").closest("td").addClass("hidden");else{var d=e(t).find("select.edd-slack-download"),n=e(t).find("select.edd-slack-exclude-download");void 0!==eddSlack.variantExclusion&&eddSlack.variantExclusion.indexOf(a)>-1?(null!==d.val()&&d.val().every(function(e){return e.indexOf("-")>-1})&&d.val(0),null!==n.val()&&n.val().every(function(e){return e.indexOf("-")>-1})&&n.val(0),d.find('option[value*="-"]').hide(),n.find('option[value*="-"]').hide()):(d.find('option[value*="-"]').show(),n.find('option[value*="-"]').show()),d.hasClass("edd-slack-chosen")&&d.trigger("chosen:updated"),n.hasClass("edd-slack-chosen")&&n.trigger("chosen:updated"),e(t).find(".edd-slack-conditional."+a).closest("td.hidden").removeClass("hidden"),e(t).find(".edd-slack-conditional").not("."+a).closest("td").addClass("hidden"),e(t).find(".edd-slack-replacement-instruction."+a).removeClass("hidden"),e(t).find(".edd-slack-replacement-instruction").not("."+a).addClass("hidden")}e(t).find(".required").each(function(t,a){e(a).closest("td").hasClass("hidden")?e(a).attr("required",!1):e(a).attr("required",!0),e(a).hasClass("edd-slack-chosen")&&(e(a).chosen(),e(a).attr("tabindex",-1),e(a).siblings(".chosen-container").find(".chosen-single").attr("tabindex",0))}),e(t).find('input[type="checkbox"].default-checked').each(function(t,a){e(a).prop("checked",!0)}),e(t).find(".edd-help-tip").each(function(t,a){e(a).tooltip({content:function(){return e(a).prop("title")},tooltipClass:"edd-ui-tooltip",position:{my:"center top",at:"center bottom+10",collision:"flipfit"},hide:{duration:200},show:{duration:200}})}),e(document).trigger("edd-slack-conditional-fields-set",t)},a=function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"edd-rbm-repeater-add"==t.type||"edd-slack-conditional-fields-set"==t.type?(t=a,a=!1):t=e(t).closest(".edd-rbm-repeater-content");var d=e(t).find(".edd-slack-download");a===!1&&(a=d.val()),!e(d.closest("td")[0]).hasClass("hidden")&&null!==a&&a.indexOf("all")>-1?e(t).find(".edd-slack-exclude-download").closest("td").removeClass("hidden"):e(t).find(".edd-slack-exclude-download").closest("td").addClass("hidden")},d=function(){e(".repeater-header div[data-repeater-default-title]").each(function(t,a){var d=!0,n=e(a).closest("div[data-repeater-item]"),i=n.find("[data-repeater-edit]").data("open"),r=e('[data-reveal="'+i+'"]');r.find(".required").each(function(t,a){if(!e(a).closest("td").hasClass("hidden")&&null===e(a).val())return d=!1,!1}),""==r.find(".edd-slack-post-id").val()&&(d=!1),""==e(".edd-slack-webhook-default").val()&&""==r.find(".edd-slack-webhook-url").val()&&(d=!1),e(a).siblings(".status-indicator").remove(),d===!0?e(a).after('<span class="active status-indicator dashicons dashicons-yes" aria-label="'+eddSlack.i18n.inactiveText+'"></span>'):e(a).after('<span class="inactive status-indicator dashicons dashicons-no" aria-label="'+eddSlack.i18n.inactiveText+'"></span>')})},n=function(){var n=e("[data-edd-rbm-repeater]");n.length&&(n.on("edd-rbm-repeater-add",t),n.on("repeater-show",t),n.on("edd-rbm-repeater-add",a),n.on("repeater-show",a),e(document).on("closed.zf.reveal",".edd-rbm-repeater-content.reveal",function(){d()}))};n(),e(document).ready(function(){e(".edd-slack-trigger").each(function(a,d){t(d,e(d).val())}),e(".repeater-header div[data-repeater-default-title]").each(function(t,a){var d=e(a).closest("div[data-repeater-item]"),n=d.find("[data-repeater-edit]").data("open"),i=e('[data-reveal="'+n+'"]');init_edd_repeater_colorpickers(i),init_edd_repeater_chosen(i)}),d(),e(document).on("change",".edd-slack-trigger",function(){t(e(this),e(this).val())}),e(document).on("change",".edd-slack-download",function(){var t=e(this).val(),d="";if(null!==t&&(d=t.filter(function(e){return eddSlackSelectedDownloads.indexOf(e)<0}),eddSlackSelectedDownloads=t),"all"==d)e(this).val("all"),e(this).hasClass("edd-slack-chosen")&&e(this).trigger("chosen:updated");else if(null!==t&&t.length>1&&t.indexOf("all")>-1){for(var n in t)"all"==t[n]&&t.splice(n,1);e(this).val(t),e(this).hasClass("edd-slack-chosen")&&e(this).trigger("chosen:updated")}a(e(this),e(this).val())}),e(document).on("edd-slack-conditional-fields-set",function(e,t){a(e,t)})})}(jQuery),function(e){e.EDDSlackOauthPopup=function(e){e.windowName=e.windowName||"ConnectWithOAuth",e.windowOptions=e.windowOptions||"location=0,status=0,width=800,height=400",e.callback=e.callback||function(){window.location.reload()},e.redirectURI=e.redirectURI||!1,e.tokenType=e.tokenType||"main";var t=this;t._oauthWindow=window.open(e.path,e.windowName,e.windowOptions),t._oauthInterval=setInterval(function(){try{t._oauthWindow.location.href.indexOf(e.redirectURI)!==-1&&t._oauthWindow.location.href.indexOf("&code=")!==-1&&t._oauthWindow.location.href.indexOf("&error=access_denied")==-1?(clearInterval(t._oauthInterval),e.redirectURI=t._oauthWindow.location.href.replace("&state=","&state=saving&token_type="+e.tokenType),e.callback(e.redirectURI),t._oauthWindow.close()):t._oauthWindow.location.href.indexOf("&error=access_denied")!==-1&&t._oauthWindow.close()}catch(a){}},100)},e(document).ready(function(){e(".edd-slack-app-auth").length>0&&e(".edd-slack-app-auth").on("click",function(t){t.preventDefault();for(var a,d=e(this).attr("href"),n=/[?&]([^=#]+)=([^&#]*)/g,i="";null!==(a=n.exec(d));)"redirect_uri"===a[1]&&(i=decodeURIComponent(a[2]));var r=void 0!=window.screenLeft?window.screenLeft:screen.left,o=void 0!=window.screenTop?window.screenTop:screen.top,l=700,c=650,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,u=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,p=s/2-l/2+r,f=u/2-c/2+o;e.EDDSlackOauthPopup({path:d,redirectURI:i,windowOptions:"location=0,status=0,width="+l+",height="+c+",top="+f+",left="+p,tokenType:e(this).data("token_type"),callback:function(e){window.location=e}})})})}(jQuery);
//# sourceMappingURL=admin.js.map
