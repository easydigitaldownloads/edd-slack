"use strict";function init_edd_repeater_colorpickers(e){var d=/value="(#(?:[0-9a-f]{3}){1,2})"/i;0<jQuery(e).find(".edd-color-picker").length&&jQuery(e).find(".edd-color-picker").each(function(e,t){var a=null!==(a=d.exec(jQuery(t)[0].outerHTML))?a[1]:jQuery(t).data("defaultColor");jQuery(t).val(a).attr("value",a).wpColorPicker()})}function init_edd_repeater_chosen(e){jQuery(e).find("select.edd-slack-chosen").length&&jQuery(e).find(".edd-slack-chosen").chosen()}function initModals(){jQuery(".edd-rbm-repeater .edd-rbm-repeater-item").each(function(e,t){if(""!==(d=jQuery(t).find(".edd-rbm-repeater-content.reveal")).attr("data-reveal"))return!0;var a=Math.round(Math.pow(36,7)-Math.random()*Math.pow(36,6)).toString(36).slice(1)+"-reveal";d.attr("data-reveal",a);jQuery(t).find("input[data-repeater-edit]").attr("data-open",a);var d=new Foundation.Reveal(d)})}function openModal(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;"edd-rbm-repeater-add"==e.type&&(e=jQuery(t).find("input[data-repeater-edit]").data("open"));var a=jQuery('[data-reveal="'+e+'"]');eddSlackSelectedDownloads=null===(eddSlackSelectedDownloads=a.find(".edd-slack-download").val())?[]:eddSlackSelectedDownloads,a.foundation("open"),a.closest(".reveal-overlay").scrollTop(0)}function closeModal(e){jQuery('[data-reveal="'+e+'"]').foundation("close")}!function(c){c(document).ready(function(){c("#edd_slack_team_customer_invite_form, #edd_slack_team_vendor_invite_form").submit(function(e){e.preventDefault();var t=c(this),a=c(document.activeElement);a.attr("disabled",!0),t.find(".notice-wrap").remove(),t.append('<div class="notice-wrap"><span class="spinner is-active"></span></div>');var d=function(e,t){var a=1<arguments.length&&void 0!==t?t:void 0;void 0===a&&(a=window.location.href);for(var d=(a=a.replace(/#.*$/,"")).split("&"),n=0;n<d.length;n++){var i=d[n].split("=");if(i[0]==e)return i[1]}return!1}("id"),n="customer";"edd_slack_team_vendor_invite_form"==e.currentTarget.id&&(n="vendor");var i,r,o,l=(i=d,r=n,o={},c.ajax({async:!1,type:"POST",url:location.origin+ajaxurl,data:{id:i,type:r,_ajax_nonce:c("#edd_slack_team_invite_nonce").val(),action:"edd_slack_app_team_invite"},success:function(e){var t="";if(!1===e.ok)switch(e.error){case"channel_not_found":t=eddSlack.i18n.slackInvite.channel_not_found;break;case"no_perms":t=eddSlack.i18n.slackInvite.no_perms;break;case"already_in_team":t=eddSlack.i18n.slackInvite.already_in_team;break;default:t=e.error}else t=eddSlack.i18n.slackInvite[r+"_invite_successful"];o={ok:e.ok,message:t}},error:function(e,t,a){console.error(e.responseText),console.error(a)}}),o);l.ok?t.find(".notice-wrap").append('<div class="updated"><p>'+l.message+"</p></div>"):(t.find(".notice-wrap").append('<div class="update error"><p>'+l.message+"</p></div>"),a.attr("disabled",!1)),t.find(".notice-wrap .spinner").remove()})})}(jQuery),HTMLFormElement.prototype.reportValidity||(HTMLFormElement.prototype.reportValidity=function(){var a=eddSlack.i18n.validationError,d=!0;return jQuery(this).find(".validation-error").remove(),jQuery(this).find(".required").each(function(e,t){t.setCustomValidity(""),jQuery(t).closest("td").hasClass("hidden")||null!==jQuery(t).val()&&""!=jQuery(t).val()||(t.setCustomValidity(a),jQuery(t).before('<span class="validation-error">'+a+"</span>"),d=!1)}),d||(jQuery(this).closest(".reveal-overlay").scrollTop(jQuery(this).find(".validation-error:first-of-type")),d)}),function(i){var a,d,e=i("[data-edd-rbm-repeater]");e.length&&(a=function(){i(this).find(".repeater-header div.title").html(i(this).find(".repeater-header div.title").data("repeater-default-title")),i(this).stop().slideDown();var e=i(this).closest("[data-edd-rbm-repeater]");i(e).trigger("edd-rbm-repeater-add",[i(this)])},d=function(){var e,t,a,d,n=i(this).closest("[data-edd-rbm-repeater]");confirm(eddSlack.i18n.confirmDeletion)&&(t=(e=i(this)).find("[data-repeater-edit]").data("open"),d=(a=i('[data-reveal="'+t+'"]')).find(".edd-slack-post-id").val(),i.ajax({type:"POST",url:eddSlack.ajax,data:{action:"delete_edd_rbm_slack_notification",post_id:d},success:function(){a.parent().remove(),e.stop(),setTimeout(function(){e.effect("highlight",{color:"#FFBABA"},300).dequeue().slideUp(300,function(){e.remove()})}),i(n).trigger("edd-rbm-repeater-remove",[e])},error:function(){}}))},e.each(function(){var t=i(this),e=t.find("[data-repeater-dummy]");t.repeater({repeaters:[{show:a,hide:d}],show:a,hide:d,ready:function(e){t.find("tbody").on("sortupdate",e)}}),e.length&&e.remove(),i(document).on("closed.zf.reveal",".edd-rbm-repeater-content.reveal",function(){var e,t=i(this).find('td:first-of-type input[type!="hidden"]'),a=i(this).closest(".edd-rbm-repeater-content.reveal").data("reveal"),d=i('[data-open="'+a+'"]');""!==i(t).val()?d.closest(".edd-rbm-repeater-item").find(".repeater-header div.title").html(i(t).val()):(e=d.closest(".edd-rbm-repeater-item").find(".repeater-header div.title").data("repeater-default-title"),d.closest(".edd-rbm-repeater-item").find(".repeater-header div.title").html(e))})}))}(jQuery),function(c){c(document).ready(function(){c(document).on("open.zf.reveal",".edd-rbm-repeater-content.reveal",function(e){var o,l;o=e.currentTarget,l=c(o).find("form"),c(o).hasClass("has-form")||(l=c(o).find(".edd-rbm-repeater-form").wrap('<form method="POST" novalidate></form>').parent(),c(o).addClass("has-form"),l.submit(function(e){var t,i,r,d=c(document.activeElement),n=d.val();d.val(d.data("saving_text")).attr("disabled",!0),e.preventDefault(),l[0].reportValidity(),l[0].checkValidity()?(t=c(".edd-rbm-repeater-list").data("repeater-list"),i=new RegExp(t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"\\[\\d\\]\\[(.*)\\]","gi"),r={},c(this).find(".edd-slack-field:not( .chosen-container )").each(function(e,t){if(c(t).parent().hasClass("hidden"))return!0;var a=c(t).attr("name"),d=i.exec(a),n=c(t).val();c(t).is('input[type="checkbox"]')&&(n=c(t).prop("checked")?1:0),r[d[1].replace("][","")]=n,i.lastIndex=0}),r.action="insert_edd_rbm_slack_notification",c.ajax({type:"POST",url:eddSlack.ajax,data:r,success:function(e){var t=c(o).data("reveal"),a=c('[data-open="'+t+'"]').closest(".edd-rbm-repeater-item");l.find(".edd-slack-post-id").val(e.data.post_id),closeModal(t),d.val(n).attr("disabled",!1),a.effect("highlight",{color:"#DFF2BF"},1e3)},error:function(){}})):d.val(n).attr("disabled",!1)}))})})}(jQuery),function(t){t(document).ready(function(){initModals();var e=t("[data-edd-rbm-repeater]");e.length&&(e.on("edd-rbm-repeater-add",initModals),e.on("edd-rbm-repeater-add",openModal))}),t(document).on("click touched","[data-repeater-edit]",function(){openModal(t(this).data("open"))}),t(document).on("open.zf.reveal",".edd-rbm-repeater-content.reveal",function(){init_edd_repeater_colorpickers(this),init_edd_repeater_chosen(this)})}(jQuery);var eddSlackSelectedDownloads=[];!function(i){function a(e,t){var a,d;"edd-rbm-repeater-add"==e.type?(e=t,t=0):e=i(e).closest(".edd-rbm-repeater-content"),0==t?(i(e).find("select").each(function(e,t){i(t).val(0),i(t).hasClass("edd-slack-chosen")&&i(t).trigger("chosen:updated")}),i(e).find(".edd-slack-conditional").closest("td").addClass("hidden"),i(e).find(".edd-slack-replacement-instruction").closest("td").addClass("hidden")):(a=i(e).find("select.edd-slack-download"),d=i(e).find("select.edd-slack-exclude-download"),void 0!==eddSlack.variantExclusion&&-1<eddSlack.variantExclusion.indexOf(t)?(null!==a.val()&&a.val().every(function(e){return-1<e.indexOf("-")})&&a.val(0),null!==d.val()&&d.val().every(function(e){return-1<e.indexOf("-")})&&d.val(0),a.find('option[value*="-"]').hide(),d.find('option[value*="-"]').hide()):(a.find('option[value*="-"]').show(),d.find('option[value*="-"]').show()),a.hasClass("edd-slack-chosen")&&a.trigger("chosen:updated"),d.hasClass("edd-slack-chosen")&&d.trigger("chosen:updated"),i(e).find(".edd-slack-conditional."+t).closest("td.hidden").removeClass("hidden"),i(e).find(".edd-slack-conditional").not("."+t).closest("td").addClass("hidden"),i(e).find(".edd-slack-replacement-instruction."+t).removeClass("hidden"),i(e).find(".edd-slack-replacement-instruction").not("."+t).addClass("hidden")),i(e).find(".required").each(function(e,t){i(t).closest("td").hasClass("hidden")?i(t).attr("required",!1):i(t).attr("required",!0),i(t).hasClass("edd-slack-chosen")&&(i(t).chosen(),i(t).attr("tabindex",-1),i(t).siblings(".chosen-container").find(".chosen-single").attr("tabindex",0))}),i(e).find('input[type="checkbox"].default-checked').each(function(e,t){i(t).prop("checked",!0)}),i(e).find(".edd-help-tip").each(function(e,t){i(t).tooltip({content:function(){return i(t).prop("title")},tooltipClass:"edd-ui-tooltip",position:{my:"center top",at:"center bottom+10",collision:"flipfit"},hide:{duration:200},show:{duration:200}})}),i(document).trigger("edd-slack-conditional-fields-set",e)}function d(e,t){var a=1<arguments.length&&void 0!==t&&t;"edd-rbm-repeater-add"==e.type||"edd-slack-conditional-fields-set"==e.type?(e=a,a=!1):e=i(e).closest(".edd-rbm-repeater-content");var d=i(e).find(".edd-slack-download");!1===a&&(a=d.val()),!i(d.closest("td")[0]).hasClass("hidden")&&null!==a&&-1<a.indexOf("all")?i(e).find(".edd-slack-exclude-download").closest("td").removeClass("hidden"):i(e).find(".edd-slack-exclude-download").closest("td").addClass("hidden")}function e(){i(".repeater-header div[data-repeater-default-title]").each(function(e,t){var a=!0,d=i(t).closest("div[data-repeater-item]").find("[data-repeater-edit]").data("open"),n=i('[data-reveal="'+d+'"]');n.find(".required").each(function(e,t){if(!i(t).closest("td").hasClass("hidden")&&null===i(t).val())return a=!1}),""==n.find(".edd-slack-post-id").val()&&(a=!1),""==i(".edd-slack-webhook-default").val()&&""==n.find(".edd-slack-webhook-url").val()&&(a=!1),i(t).siblings(".status-indicator").remove(),!0===a?i(t).after('<span class="active status-indicator dashicons dashicons-yes" aria-label="'+eddSlack.i18n.inactiveText+'"></span>'):i(t).after('<span class="inactive status-indicator dashicons dashicons-no" aria-label="'+eddSlack.i18n.inactiveText+'"></span>')})}var t;(t=i("[data-edd-rbm-repeater]")).length&&(t.on("edd-rbm-repeater-add",a),t.on("repeater-show",a),t.on("edd-rbm-repeater-add",d),t.on("repeater-show",d),i(document).on("closed.zf.reveal",".edd-rbm-repeater-content.reveal",function(){e()})),i(document).ready(function(){i(".edd-slack-trigger").each(function(e,t){a(t,i(t).val())}),i(".repeater-header div[data-repeater-default-title]").each(function(e,t){var a=i(t).closest("div[data-repeater-item]").find("[data-repeater-edit]").data("open"),d=i('[data-reveal="'+a+'"]');init_edd_repeater_colorpickers(d),init_edd_repeater_chosen(d)}),e(),i(document).on("change",".edd-slack-trigger",function(){a(i(this),i(this).val())}),i(document).on("change",".edd-slack-download",function(){var e=i(this).val(),t="";if(null!==e&&(t=e.filter(function(e){return eddSlackSelectedDownloads.indexOf(e)<0}),eddSlackSelectedDownloads=e),"all"==t)i(this).val("all"),i(this).hasClass("edd-slack-chosen")&&i(this).trigger("chosen:updated");else if(null!==e&&1<e.length&&-1<e.indexOf("all")){for(var a in e)"all"==e[a]&&e.splice(a,1);i(this).val(e),i(this).hasClass("edd-slack-chosen")&&i(this).trigger("chosen:updated")}d(i(this),i(this).val())}),i(document).on("edd-slack-conditional-fields-set",function(e,t){d(e,t)})})}(jQuery),function(c){c.EDDSlackOauthPopup=function(e){e.windowName=e.windowName||"ConnectWithOAuth",e.windowOptions=e.windowOptions||"location=0,status=0,width=800,height=400",e.callback=e.callback||function(){window.location.reload()},e.redirectURI=e.redirectURI||!1,e.tokenType=e.tokenType||"main";var t=this;t._oauthWindow=window.open(e.path,e.windowName,e.windowOptions),t._oauthInterval=setInterval(function(){try{-1!==t._oauthWindow.location.href.indexOf(e.redirectURI)&&-1!==t._oauthWindow.location.href.indexOf("&code=")&&-1==t._oauthWindow.location.href.indexOf("&error=access_denied")?(clearInterval(t._oauthInterval),e.redirectURI=t._oauthWindow.location.href.replace("&state=","&state=saving&token_type="+e.tokenType),e.callback(e.redirectURI),t._oauthWindow.close()):-1!==t._oauthWindow.location.href.indexOf("&error=access_denied")&&t._oauthWindow.close()}catch(e){}},100)},c(document).ready(function(){0<c(".edd-slack-app-auth").length&&c(".edd-slack-app-auth").on("click",function(e){e.preventDefault();for(var t,a=c(this).attr("href"),d=/[?&]([^=#]+)=([^&#]*)/g,n="";null!==(t=d.exec(a));)"redirect_uri"===t[1]&&(n=decodeURIComponent(t[2]));var i=null!=window.screenLeft?window.screenLeft:screen.left,r=null!=window.screenTop?window.screenTop:screen.top,o=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-350+i,l=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-325+r;c.EDDSlackOauthPopup({path:a,redirectURI:n,windowOptions:"location=0,status=0,width=700,height=650,top="+l+",left="+o,tokenType:c(this).data("token_type"),callback:function(e){window.location=e}})})})}(jQuery);